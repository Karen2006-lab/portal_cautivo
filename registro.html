<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro de Usuario</title>
  <style>
    body {
      background: url('imagen/imagen 1.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 10px;
      box-sizing: border-box;
    }

    .top-container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 40px;
      max-width: 1100px;
      margin: 0 auto;
      flex-wrap: wrap;
    }

    .registro-container {
      background-color: rgba(213, 234, 247, 0.95);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      width: 380px;
      box-sizing: border-box;
    }

    .registro-container img {
      display: block;
      margin: 0 auto 10px auto;
      max-width: 140px;
      height: auto;
    }

    h2 {
      color: #0a3056;
      font-size: 20px;
      margin-bottom: 10px;
      text-align: center;
    }

    label {
      font-weight: bold;
      font-size: 14px;
      display: block;
      margin-top: 10px;
      text-align: left;
    }

    input[type="text"],
    input[type="email"],
    input[type="password"],
    select {
      width: 100%;
      padding: 8px;
      margin-top: 3px;
      border-radius: 8px;
      border: 1px solid #6062bc;
      font-size: 14px;
      box-sizing: border-box;
    }

    input[type="submit"] {
      margin-top: 15px;
      width: 100%;
      padding: 10px;
      background-color: #0e08be;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      cursor: pointer;
    }

    input[type="submit"]:hover {
      background-color: #005fa3;
    }

    .link-login {
      margin-top: 10px;
      font-size: 0.9em;
      color: #0e08be;
      text-align: center;
    }

    .link-login a {
      color: #0e08be;
      text-decoration: none;
      font-weight: 600;
    }

    .link-login a:hover {
      text-decoration: underline;
    }

    .bienvenida {
      background-color: rgba(255, 255, 255, 0.9);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      font-weight: bold;
      color: #003366;
      max-width: 300px;
      text-align: center;
      margin-top: 10px;
    }

    .carousel-container {
      width: 300px;
      position: relative;
      max-width: 300px;
      margin: 10px auto 0 auto;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
      background-color: white;
    }

   .carousel-slide {
  width: 300px;
  height: 400px; /* antes 200px */
  position: relative;
}

.carousel-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: none;
}


    .carousel-image.active {
      display: block;
    }

    .carousel-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background-color: rgba(14,8,190,0.7);
      color: white;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
      border-radius: 50%;
      font-size: 20px;
      user-select: none;
    }

    .prev-btn { left: 10px; }
    .next-btn { right: 10px; }

    .carousel-btn:hover {
      background-color: rgba(14,8,190,0.9);
    }

    @media (max-width: 768px) {
      .top-container {
        flex-direction: column;
        align-items: center;
      }

      .registro-container,
      .bienvenida {
        width: 90%;
        max-width: 400px;
        margin-bottom: 20px;
      }

      .bienvenida {
        order: -1;
        margin-top: 0;
      }
    }
  </style>
</head>
<body>
  <div class="top-container">
    <div class="registro-container">
      <div id="verificacionNombre" style="font-weight: bold; margin-bottom: 5px; display:none;"></div>
      <img src="imagen/imagen2.png" alt="Logo Instituto" />
      <h2>Registro de Usuario</h2>
      <form action="registro_procesar.php" method="POST" id="registroForm">
        <label for="nombre">Nombre:</label>
        <input type="text" name="nombre" required />

        <label for="apellido">Apellido:</label>
        <input type="text" name="apellido" required />

        <label for="cedula">Cédula:</label>
        <input type="text" name="cedula" required />

        <label for="correo">Correo:</label>
        <input type="email" name="correo" required />

        <label for="contrasena">Contraseña:</label>
        <input type="password" name="contrasena" required />

        <label for="contrasena_confirm">Confirmar Contraseña:</label>
        <input type="password" name="contrasena_confirm" required />

        <label for="rol">Rol:</label>
        <select name="rol" required>
          <option value="">Selecciona un rol</option>
          <option value="usuario">Usuario</option>
          <option value="administrador">Administrador</option>
        </select>

        <input type="submit" value="Registrarse" />
      </form>

      <div class="link-login">
        ¿Ya tienes una cuenta? <a href="login.php">Inicia sesión aquí</a>
      </div>
    </div>

    <div>
      <div class="bienvenida">Zona DS</div>

      <!-- Carrusel de imágenes -->
      <div class="carousel-container">
        <div class="carousel-slide">
          <img src="imagen/carrusel1.jpg" class="carousel-image active" />
          <img src="imagen/carrusel4.jpg" class="carousel-image" />
          <img src="imagen/carrusel3.jpg" class="carousel-image" />
        </div>
        <button class="carousel-btn prev-btn">&#10094;</button>
        <button class="carousel-btn next-btn">&#10095;</button>
      </div>
    </div>
  </div>

  <script>
    const images = document.querySelectorAll('.carousel-image');
    let currentIndex = 0;

    function showImage(index) {
      images.forEach((img, i) => {
        img.classList.toggle('active', i === index);
      });
    }

    function nextImage() {
      currentIndex = (currentIndex + 1) % images.length;
      showImage(currentIndex);
    }

    function prevImage() {
      currentIndex = (currentIndex - 1 + images.length) % images.length;
      showImage(currentIndex);
    }

    document.querySelector('.next-btn').addEventListener('click', nextImage);
    document.querySelector('.prev-btn').addEventListener('click', prevImage);

    // Cambiar imagen automáticamente cada 4 segundos
    setInterval(nextImage, 4000);
  </script>

  <script>
document.addEventListener('DOMContentLoaded', () => {
    const cedulaInput = document.querySelector('input[name="cedula"]');
    const nombreInput = document.querySelector('input[name="nombre"]');
    const apellidoInput = document.querySelector('input[name="apellido"]');
    const correoInput = document.querySelector('input[name="correo"]');
    const rolSelect = document.querySelector('select[name="rol"]');
    const mensajeDiv = document.getElementById('verificacionNombre');
    const submitBtn = document.querySelector('input[type="submit"]');

    // Por defecto deshabilitar botón para que no registre sin cédula válida
    submitBtn.disabled = true;

    cedulaInput.addEventListener('blur', () => {
        const cedula = cedulaInput.value.trim();
        if (cedula === "") return;

        const formData = new FormData();
        formData.append("cedula", cedula);

        fetch("verificar_usuario_por_cedula.php", {
            method: "POST",
            body: formData
        })
        .then(res => res.json())
        .then(data => {
            if (data.existe) {
                // Llenar campos
                nombreInput.value = data.nombre;
                apellidoInput.value = data.apellido;
                correoInput.value = data.correo;
                rolSelect.value = data.rol;

                // Quitar readOnly y disabled para permitir modificar datos
                nombreInput.readOnly = false;
                apellidoInput.readOnly = false;
                correoInput.readOnly = false;
                rolSelect.disabled = false;

                if (data.tiene_contrasena) {
                    mensajeDiv.textContent = "⚠️ Usuario ya registrado. Puedes modificar tus datos o cambiar tu contraseña.";
                    mensajeDiv.style.color = "#155724"; // verde oscuro
                } else {
                    mensajeDiv.textContent = "✔️ Usuario encontrado. Ingresa tu contraseña para completar el registro.";
                    mensajeDiv.style.color = "#155724";
                }
                mensajeDiv.style.display = "block";
                submitBtn.disabled = false; // habilitar botón
            } else {
                // Limpiar campos
                nombreInput.value = "";
                apellidoInput.value = "";
                correoInput.value = "";
                rolSelect.value = "";

                // Permitir ingresar nuevos datos (si quieres permitir registro de nuevos usuarios con cédula no encontrada, acá habilita botón y cambia lógica)
                nombreInput.readOnly = false;
                apellidoInput.readOnly = false;
                correoInput.readOnly = false;
                rolSelect.disabled = false;

                mensajeDiv.textContent = "❌ Cédula no encontrada.";
                mensajeDiv.style.color = "#721c24";
                mensajeDiv.style.display = "block";
                submitBtn.disabled = true; // deshabilitar botón para evitar registro
            }
        })
        .catch(() => {
            mensajeDiv.textContent = "⚠️ Error al consultar la cédula.";
            mensajeDiv.style.color = "#721c24";
            mensajeDiv.style.display = "block";
            submitBtn.disabled = true;
        });
    });
});
</script>
</body>
</html>